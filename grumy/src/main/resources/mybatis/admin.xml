<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="spring.model.mapper.AdminMapper">
	<select id="total" parameterType="int" resultType="int">
		select count(state) from orderItem where state = #{state}
	</select>
	
	<resultMap type="orderDTO" id="orderMap">
		<result property="id" column="id"/>
		<result property="orderNo" column="orderno"/>
		<result property="odate" column="odate"/>
		<collection property="orderItemList" column="orderno"
			javaType="List" ofType="OrderItemDTO" resultMap="orderItemDTOListMap" />
	</resultMap>
	<resultMap type="OrderItemDTO" id="orderItemDTOListMap">
		<result property="itemCount" column="itemcount"/>
		<result property="state" column="state"/>	
		<result property="itemPrice" column="itemPrice"/>	
		<result property="itemTitle" column="itemTitle"/>	
		<result property="itemSize" column="itemSize"/>	
		<result property="itemColor" column="itemColor"/>	
		<result property="orderItemNo" column="orderItemNo"/>	
	</resultMap>
	
	<select id="list" parameterType="int" resultMap="orderMap">
		select b.orderItemNo orderItemNo, a.orderno orderno, a.id id, a.odate odate, b.itemcount itemcount,  b.state state, 
		(i.Price -i.SalePrice) itemPrice, i.title itemTitle, o.itemSize itemSize, o.itemColor itemColor
		from norder a, orderitem b ,item i, itemOption o
		where a.orderno = b.orderno and b.itemOptionNo = o.itemOptionNo and i.itemNo = o.itemNo and b.state = #{state} order by a.orderno desc
	</select>
	
	<select id="noticel" parameterType="int" resultType="NoticeDTO">
		select no, subject, wdate from (
		select no, subject, to_char(wdate, 'mm.dd.') wdate from notice order by no desc)
		<![CDATA[
		where rownum <=#{rownum}
		]]>
	</select>

	<select id="deliveryl" parameterType="int" resultType="DeliveryDTO">
		select no, subject, wdate from (
		select no, subject, to_char(wdate, 'mm.dd.') wdate, lev from delivery where indent = 0 order by no desc)
		<![CDATA[
		where rownum <=#{rownum} 
		]]>
		and LEV = 'A'
	</select>

	<select id="communityl" parameterType="int" resultType="communityDTO">
		select communityno, content, wdate from (
		select communityno, content, to_char(wdate, 'mm.dd.') wdate from community order by communityno desc)
		<![CDATA[
		where rownum <=#{rownum}
		]]>
	</select>
	
	
	<!-- 
		<update id="updateStat" parameterType="Map">
		update admintest  
		set stat = stat + 100
		where no = #{no} 
	</update>	
	 -->
</mapper>