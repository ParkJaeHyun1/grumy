<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="spring.model.mapper.communityMapper">

<insert id="create_reply" parameterType="communityDTO">
insert into community(communityNo,content,picture,wdate,ref,indent,id,ansnum,itemNo)
values((select nvl(max(communityNo),0)+1 from community),#{content},#{picture,jdbcType=VARCHAR},sysdate,#{ref},#{indent}+1,#{id},#{ansnum}+1,#{itemNo})
</insert>


<update id="update" parameterType="int">
	update community 
	set content = #{content},
		picture = #{picture,jdbcType=VARCHAR}
	where communityNo = #{communityNo}
</update>

<delete id="delete" parameterType="int">
delete from community
where communityNo = #{communityNo}
</delete>

<select id="read" parameterType="int" resultType="communityDTO">
select communityNo,content,id,wdate,picture
from community
where communityNo = #{communityNo}
</select>

	<select id="list" parameterType="Map" resultType="communityDTO">
		select communityNo,id,wdate,itemPicture,itemTitle,itemNo
		from (
		select communityNo,id,wdate,i.itemNo,
		i.image as itemPicture,i.title as itemTitle, rownum rnum
		from item i, community c
		where c.itemNo = i.itemno)
		<![CDATA[ where rnum>=1 and rnum<=5]]>
</select>



<insert id="create" parameterType="communityDTO">
INSERT INTO community(communityNo, id, content,itemNo,picture,wdate,ref)
 VALUES((SELECT NVL(MAX(communityNo), 0) + 1 as communityNo FROM community),
#{id},#{content},#{itemNo},#{picture, jdbcType=VARCHAR},sysdate,(SELECT NVL(MAX(ref), 0) + 1  FROM community))

</insert>
</mapper>