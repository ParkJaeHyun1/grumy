<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="spring.model.mapper.MypageMapper">

<select id="read" parameterType="String" resultType="MemberDTO">
select * from member
where id = #{id}
</select>
<select id="orderCount" parameterType="String" resultType="OrderItemDTO">
select i.state,count(*) as count
from
norder o,orderitem i
where id = #{id} and o.orderno=i.orderno and i.state2 is null
group by i.state
order by i.state
</select>
<select id="orderCount2" parameterType="String" resultType="OrderItemDTO">
select i.state2,count(*) as count
from
norder o,orderitem i
where id = #{id} and o.orderno=i.orderno
group by i.state2
order by i.state2
</select>

	<resultMap type="orderDTO" id="orderMap">
		<result property="orderNo" column="orderno"/>
		<result property="odate" column="odate"/>
		<collection property="orderItemList" column="orderno"
			javaType="List" ofType="OrderItemDTO" resultMap="orderItemDTOListMap" />
	</resultMap>
	<resultMap type="OrderItemDTO" id="orderItemDTOListMap">
		<result property="itemNo" column="itemno"/>
		<result property="itemImage" column="image"/>
		<result property="count" column="count"/>
		<result property="state" column="state"/>	
		<result property="itemPrice" column="itemPrice"/>	
		<result property="itemTitle" column="itemTitle"/>	
		<result property="itemSize" column="itemSize"/>	
		<result property="itemColor" column="itemColor"/>	
		<result property="orderItemNo" column="orderItemNo"/>	
	</resultMap>
	
	<select id="list" parameterType="map" resultMap="orderMap">
		select * from
		(select orderno, odate, orderItemNo,itemno, count, state, itemPrice,image, itemTitle, itemSize, itemColor, rownum r from
		(select b.orderItemNo orderItemNo,i.itemno itemno, a.orderno orderno, to_char(a.odate, 'yyyy-MM-dd') odate, b.count count,  b.state state, 
			b.itemprice itemPrice, i.title itemTitle,i.image image, o.itemSize itemSize, o.itemColor itemColor
			from norder a, orderitem b ,item i, itemOption o
			where a.orderno = b.orderno and b.itemOptionNo = o.itemOptionNo and i.itemNo = o.itemNo and id = #{id} and b.state=#{state}

			order by a.orderno desc
			))
		<![CDATA[
		where r >=#{sno} and r<=#{eno}
		]]>
	</select>
	
	<select id="total" parameterType="Map" resultType="int">
	select count(*) from(
		(select orderno, odate, orderItemNo, count, state, itemPrice,image, itemTitle, itemSize, itemColor, rownum r from
		(select b.orderItemNo orderItemNo, a.orderno orderno, to_char(a.odate, 'yyyy-MM-dd') odate, b.count count,  b.state state, 
			b.itemprice itemPrice, i.title itemTitle,i.image image, o.itemSize itemSize, o.itemColor itemColor
			from norder a, orderitem b ,item i, itemOption o
			where a.orderno = b.orderno and b.itemOptionNo = o.itemOptionNo and i.itemNo = o.itemNo and id = #{id} and b.state=#{state}
			)))
	</select>

</mapper>