<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="spring.model.mapper.reviewMapper">

<delete id="delete" parameterType="int">
delete from review
where reviewNo = #{reviewNo}
</delete>

<insert id="create" parameterType="reviewDTO">
INSERT INTO review(reviewNo,id,content,height,weight,mySize,itemOptionNo,picture,star) 
VALUES((SELECT NVL(MAX(reviewNo), 0) + 1 as no FROM review),'tester1',#{content},#{height},#{weight},#{mySize},#{itemOptionNo},#{picture, jdbcType=VARCHAR},#{star})
</insert>



	<select id="list" resultType="reviewDTO">
		select reviewNo, id, content, picture,itemPicture,itemTitle,height,weight,mySize,star,itemColor,itemSize,itemNo
		from(
		select reviewNo, id,r.content,r.picture,i.image as itemPicture,i.title as itemTitle,height,weight,mySize,star,rownum rnum,itemColor,itemSize,i.itemNo
		from item i, review r, itemOption o
		where r.itemOptionNo = o.itemOptionNo and o.itemNo = i.itemNo
		
		)
		<![CDATA[ where rnum>=#{sno} and rnum<=#{eno}]]>
		ORDER BY reviewNo desc
	</select>

	<select id="itemReviewlist" resultType="reviewDTO">
		select reviewNo, id, content, picture,itemPicture,itemTitle,height,weight,mySize,star,itemColor,itemSize,itemNo
		from(
		select reviewNo, id,r.content,r.picture,i.image as itemPicture,i.title as itemTitle,height,weight,mySize,star,rownum rnum,itemColor,itemSize,i.itemNo
		from item i, review r, itemOption o
		where r.itemOptionNo = o.itemOptionNo and o.itemNo = i.itemNo and i.itemNo = #{itemNo}
		)
		<![CDATA[ where rnum>=#{sno} and rnum<=#{eno} ]]>
	</select>

	<select id="read" parameterType="int" resultType="reviewDTO">
		select reviewNo, id,r.content,r.picture,i.image as itemPicture,i.title as itemTitle,height,weight,mySize,star
		from item i, review r, itemOption o
		where r.itemOptionNo = o.itemOptionNo and o.itemNo = i.itemNo;
	</select>

	<select id="pcount" resultType="int">
		select count(*) as pcount
		from review
		where picture is not null
	</select>

	<select id="total" parameterType="Map" resultType="int">
		select count(*) from review
		<where>
			<choose>
				<when test="col=='content'">
					content like '%'||#{word}||'%'
				</when>
				<when test="col=='title'">
					title like '%'||#{word}||'%'
				</when>
				<when test="col=='id'">
					id like '%'||#{word}||'%'
				</when>
			</choose>
		</where>
	</select>
</mapper>