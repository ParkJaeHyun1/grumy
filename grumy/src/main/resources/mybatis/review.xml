<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="spring.model.mapper.reviewMapper">

<insert id="create" parameterType="reviewDTO">
INSERT INTO review(no, id, itemNo, itemOption,content,picture,height,weight,mysize,star) 
VALUES((SELECT NVL(MAX(no), 0) + 1 as no FROM review),'tester1',#{itemNo},'white',#{content},#{picture, jdbcType=VARCHAR},#{height},#{weight},#{mysize},#{star})
</insert>

	<select id="list" resultType="reviewDTO">
		select no, id, itemNo, itemOption, content, picture,itemPicture,
		itemTitle, height, weight, mysize,star
		from(
		select r.no as no, r.id as id, r.itemNo as itemNo, r.itemOption as
		itemOption,
		r.content as content, r.picture as picture,i.image as itemPicture,i.title as
		itemTitle, r.height as height, r.weight as weight, r.mysize as mysize,r.star as star,rownum rnum
		from item i, review r
		where r.itemNo = i.itemno)
<![CDATA[ where rnum>=#{sno} and rnum<=#{eno}]]>
	</select>

	<select id="read" parameterType="int" resultType="reviewDTO">
		select r.no as
		no, r.id as id, r.itemNo as itemNo, r.itemOption as itemOption,
		r.content as content, r.picture as picture,
		i.image as itemPicture,i.title as itemTitle, r.height as height, r.weight as weight, r.mysize
		as mysize,r.mysize as mysize
		from item i, review r
		where r.itemNo = r.itemNo
	</select>

	<select id="pcount" resultType="int">
		select count(*) as pcount
		from review
		where picture is not null
	</select>

	<select id="total" parameterType="Map" resultType="int">
		select count(*) from review
		<where>
			<choose>
				<when test="col=='content'">
					content like '%'||#{word}||'%'
				</when>
				<when test="col=='title'">
					title like '%'||#{word}||'%'
				</when>
				<when test="col=='id'">
					id like '%'||#{word}||'%'
				</when>
			</choose>
		</where>
	</select>
</mapper>